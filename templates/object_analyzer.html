{% extends "base.html" %}
{% block title %}Object Analyzer{% endblock %}
{% block content %}
<div class="container-fluid mt-4">
    <h2>Object Analyzer</h2>
    <div class="row mb-4">
        <div class="col-md-6">
            <label for="accessTokenSelect" class="form-label">Select Access Token:</label>
            <select id="accessTokenSelect" class="form-select mb-3">
                <option value="">Choose a token</option>
                {% for token in access_tokens %}
                <option value="{{ token.id }}">{{ token.id }} - {{ token.audience }} - {{ token.email }}</option>
                {% endfor %}
            </select>
            <div class="d-grid gap-2">
                <button class="btn btn-outline-primary object-type-btn" data-object-type="users">
                    <i class="bi bi-people-fill me-2"></i>Users
                </button>
                <button class="btn btn-outline-primary object-type-btn" data-object-type="groups">
                    <i class="bi bi-diagram-3-fill me-2"></i>Groups
                </button>
                <button class="btn btn-outline-primary object-type-btn" data-object-type="servicePrincipals">
                    <i class="bi bi-gear-fill me-2"></i>Service Principals
                </button>
            </div>
        </div>
        <div class="col-md-6">
            <div id="tokenScp" class="h-100 p-2 border rounded">
                <h5 class="mb-2">Token SCP:</h5>
                <pre id="tokenScpContent" class="mb-0 small" style="max-height: 200px; overflow-y: auto;"></pre>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div id="objectDropdownContainer" class="mb-3">
                <select id="objectDropdown" class="form-select" style="width: 100%;">
                    <option value="">Select an object</option>
                </select>
            </div>
            <div id="analyzingObjectInfo" class="alert alert-info mb-3" style="display: none;"></div>
            <div id="actionButtons" class="mb-3"></div>
            <div id="results" class="mt-4"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2"></script>
    <script src="{{ url_for('static', filename='js/object_analyzer.js') }}"></script>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<style>
    .action-btn {
        width: 100%;
        text-align: left;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-size: 0.8rem;
        padding: 0.375rem 0.75rem;
    }
    .results-container {
        max-height: 400px;
        overflow-y: auto;
    }
</style>
{% endblock %}